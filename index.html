<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Token Grant Calculator</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");

    :root {
      --text-primary: #111827;
      --text-secondary: #4B5563;
      --border: #E5E7EB;
      --background: #F9FAFB;

      --danger: #D92D20;

      --radius-card: 24px;
      --radius-control: 8px;

      --shadow-card: 0px 4px 6px -2px #10182808, 0px 12px 16px -4px #10182814;
      --focus: 0 0 0 4px rgba(22, 70, 206, 0.18);

      /* 4px scale */
      --space-8: 8px;
      --space-12: 12px;
      --space-16: 16px;
      --space-20: 20px;
      --space-24: 24px;
    }

    * { box-sizing: border-box; }

    body {
      font-family: "Inter Display", Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 16px;
      line-height: 1.5;
      margin: 0;
      color: var(--text-primary);
      background: var(--background);
    }

    .page-wrapper { min-height: 100%; padding: 1rem; }
    .container { max-width: 1040px; margin: 0 auto; }
    .section { padding: 0; }

    .card {
      border: 1px solid var(--border);
      border-radius: var(--radius-card);
      padding: var(--space-24);
      box-shadow: var(--shadow-card);
      background: #fff;
      max-width: 44rem;
      width: 100%;
      margin: 0 auto;
    }

    .stack { display: flex; flex-direction: column; gap: var(--space-16); }
    .stack-lg { gap: var(--space-24); }
    .row { display: flex; gap: var(--space-12); align-items: center; flex-wrap: wrap; }
    .row-between { justify-content: space-between; }

    .heading-md { font-size: 18px; line-height: 1.3; margin: 0; letter-spacing: -0.01em; }
    .text-muted { color: var(--text-secondary); margin: 0; }
    .text-sm { font-size: 13px; line-height: 1.5; }

    .form-field { display: grid; gap: var(--space-8); }
    .label { font-size: 13px; font-weight: 500; color: var(--text-primary); }

    .input {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: var(--radius-control);
      height: 56px;
      padding: 0 var(--space-16);
      font-size: 16px;
      outline: none;
      background: #fff;
      color: var(--text-primary);
      transition: box-shadow 160ms ease, border-color 160ms ease;
    }

    .input:focus { box-shadow: var(--focus); border-color: rgba(22, 70, 206, 0.35); }

    .help, .error { font-size: 13px; margin: 0; }
    .help { color: var(--text-secondary); }
    .error { color: var(--danger); display: none; }
    .field-invalid .input { border-color: rgba(217, 45, 32, 0.45); }
    .field-invalid .error { display: block; }

    .button {
      width: 100%;
      height: 56px;
      border: 0;
      background: linear-gradient(to bottom, #3D65D6 0%, #1646CE 100%);
      color: #fff;
      font-size: 16px;
      font-weight: 500;
      border-radius: var(--radius-control);
      padding: 0 var(--space-16);
      cursor: pointer;
    }

    .results {
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transform: translateY(8px);
      transition: max-height 360ms ease, opacity 240ms ease, transform 240ms ease;
      will-change: max-height, opacity, transform;
      pointer-events: none;
    }

    .results.is-visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .results-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-12);
      margin-top: var(--space-12);
    }

    .metric {
      border: 1px solid var(--border);
      border-radius: var(--radius-control);
      padding: var(--space-16);
      background: rgba(17, 24, 39, 0.02);
    }

    .metric .k { font-size: 13px; color: var(--text-secondary); margin: 0 0 6px; }
    .metric .v { font-size: 20px; font-weight: 600; margin: 0; letter-spacing: -0.01em; }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="container section">
      <div class="stack stack-lg">
        <div class="card">
          <div class="stack">
            <div class="row row-between">
              <h2 class="heading-md">Token grant calculator</h2>
              <p class="text-muted text-sm">Estimates only.</p>
            </div>

            <!-- Inputs (minimal, only what’s needed for the 4 outputs) -->
            <div class="form-field" id="grantField">
              <label class="label" for="grantTokens">Token grant (tokens)</label>
              <input class="input" id="grantTokens" inputmode="decimal" autocomplete="off" placeholder="e.g. 50000" />
              <p class="error">Enter a valid token amount greater than 0.</p>
            </div>

            <div class="form-field" id="currentPriceField">
              <label class="label" for="currentPrice">Token price today (USD)</label>
              <input class="input" id="currentPrice" inputmode="decimal" autocomplete="off" placeholder="e.g. 0.25" />
              <p class="error">Enter a valid price (0 or greater).</p>
            </div>

            <div class="form-field" id="expectedValuationField">
              <label class="label" for="expectedValuation">Expected valuation at exit (USD)</label>
              <input class="input" id="expectedValuation" inputmode="decimal" autocomplete="off" placeholder="e.g. 1000000000" />
              <p class="error">Enter a valid valuation greater than 0.</p>
            </div>

            <div class="form-field" id="fdvSupplyField">
              <label class="label" for="fdvSupply">Fully diluted supply (tokens)</label>
              <input class="input" id="fdvSupply" inputmode="decimal" autocomplete="off" placeholder="e.g. 1000000000" />
              <p class="error">Enter a valid supply greater than 0.</p>
            </div>

            <div class="row" style="gap: var(--space-12);">
              <div class="form-field" id="vestMonthsField" style="flex: 1 1 220px;">
                <label class="label" for="vestMonths">Vesting duration (months)</label>
                <input class="input" id="vestMonths" inputmode="numeric" autocomplete="off" placeholder="e.g. 48" />
                <p class="error">Enter a valid duration (1+ months).</p>
              </div>
              <div class="form-field" id="cliffMonthsField" style="flex: 1 1 220px;">
                <label class="label" for="cliffMonths">Cliff (months)</label>
                <input class="input" id="cliffMonths" inputmode="numeric" autocomplete="off" placeholder="e.g. 12" />
                <p class="error">Enter a valid cliff (0–duration).</p>
              </div>
            </div>

            <div class="form-field" id="monthsSinceStartField">
              <label class="label" for="monthsSinceStart">Months since vesting start</label>
              <input class="input" id="monthsSinceStart" inputmode="numeric" autocomplete="off" placeholder="e.g. 18" />
              <p class="error">Enter months since start (0+).</p>
            </div>

            <div class="form-field" id="taxRateField">
              <label class="label" for="taxRate">Tax rate (%)</label>
              <input class="input" id="taxRate" inputmode="decimal" autocomplete="off" placeholder="e.g. 30" />
              <p class="help">Used to estimate tax liabilities on the values shown.</p>
              <p class="error">Enter a valid tax rate (0–100).</p>
            </div>

            <button class="button" id="calculate" type="button">Calculate</button>

            <!-- Results (only the 4 requested outputs) -->
            <div class="results" id="results" aria-hidden="true">
              <!-- Token grant → expected valuation -->
              <div class="results-grid">
                <div class="metric">
                  <p class="k">Implied exit token price</p>
                  <p class="v" id="impliedExitPrice">—</p>
                </div>
                <div class="metric">
                  <p class="k">Expected value at exit (grant)</p>
                  <p class="v" id="expectedExitValue">—</p>
                </div>
              </div>

              <!-- Vesting schedule → monthly value -->
              <div class="results-grid">
                <div class="metric">
                  <p class="k">Monthly vesting (tokens)</p>
                  <p class="v" id="monthlyTokens">—</p>
                </div>
                <div class="metric">
                  <p class="k">Monthly vesting value (today)</p>
                  <p class="v" id="monthlyValueToday">—</p>
                </div>
              </div>

              <!-- “What your tokens are worth today” -->
              <div class="results-grid">
                <div class="metric">
                  <p class="k">Vested value today</p>
                  <p class="v" id="vestedValueToday">—</p>
                </div>
                <div class="metric">
                  <p class="k">Total grant value today</p>
                  <p class="v" id="totalValueToday">—</p>
                </div>
              </div>

              <!-- Tax liabilities -->
              <div class="results-grid">
                <div class="metric">
                  <p class="k">Estimated tax on vested value today</p>
                  <p class="v" id="taxOnVestedToday">—</p>
                </div>
                <div class="metric">
                  <p class="k">Estimated tax on expected value at exit</p>
                  <p class="v" id="taxOnExitValue">—</p>
                </div>
              </div>
            </div>

            <div class="text-muted text-sm" id="resultsHint">Fill in the form to see your results.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const els = {
      grantField: document.getElementById("grantField"),
      currentPriceField: document.getElementById("currentPriceField"),
      expectedValuationField: document.getElementById("expectedValuationField"),
      fdvSupplyField: document.getElementById("fdvSupplyField"),
      vestMonthsField: document.getElementById("vestMonthsField"),
      cliffMonthsField: document.getElementById("cliffMonthsField"),
      monthsSinceStartField: document.getElementById("monthsSinceStartField"),
      taxRateField: document.getElementById("taxRateField"),

      grantTokens: document.getElementById("grantTokens"),
      currentPrice: document.getElementById("currentPrice"),
      expectedValuation: document.getElementById("expectedValuation"),
      fdvSupply: document.getElementById("fdvSupply"),
      vestMonths: document.getElementById("vestMonths"),
      cliffMonths: document.getElementById("cliffMonths"),
      monthsSinceStart: document.getElementById("monthsSinceStart"),
      taxRate: document.getElementById("taxRate"),
      calculate: document.getElementById("calculate"),

      results: document.getElementById("results"),
      resultsHint: document.getElementById("resultsHint"),

      impliedExitPrice: document.getElementById("impliedExitPrice"),
      expectedExitValue: document.getElementById("expectedExitValue"),
      monthlyTokens: document.getElementById("monthlyTokens"),
      monthlyValueToday: document.getElementById("monthlyValueToday"),
      vestedValueToday: document.getElementById("vestedValueToday"),
      totalValueToday: document.getElementById("totalValueToday"),
      taxOnVestedToday: document.getElementById("taxOnVestedToday"),
      taxOnExitValue: document.getElementById("taxOnExitValue"),
    };

    function setFieldValidity(fieldEl, isValid) {
      fieldEl.classList.toggle("field-invalid", !isValid);
    }

    function parseNumber(raw) {
      const cleaned = String(raw ?? "").trim().replace(/[, ]+/g, "");
      if (!cleaned) return NaN;
      const n = Number(cleaned);
      return Number.isFinite(n) ? n : NaN;
    }

    function parseIntSafe(raw) {
      const n = parseNumber(raw);
      if (!Number.isFinite(n)) return NaN;
      return Math.trunc(n);
    }

    function formatMoney(value, currency = "USD", { maximumFractionDigits = 2 } = {}) {
      try {
        return new Intl.NumberFormat(undefined, {
          style: "currency",
          currency,
          maximumFractionDigits,
        }).format(value);
      } catch {
        const v = Number(value) || 0;
        return `${currency} ${v.toFixed(maximumFractionDigits)}`;
      }
    }

    function formatNumber(value, { maximumFractionDigits = 2 } = {}) {
      if (!Number.isFinite(value)) return "—";
      return new Intl.NumberFormat(undefined, { maximumFractionDigits }).format(value);
    }

    function showResults() {
      els.results.setAttribute("aria-hidden", "false");
      els.resultsHint.style.display = "none";
      els.results.classList.add("is-visible");
      requestAnimationFrame(() => {
        els.results.style.maxHeight = `${els.results.scrollHeight}px`;
      });
    }

    function validate() {
      const grantTokens = parseNumber(els.grantTokens.value);
      const currentPrice = parseNumber(els.currentPrice.value);
      const expectedValuation = parseNumber(els.expectedValuation.value);
      const fdvSupply = parseNumber(els.fdvSupply.value);
      const vestMonths = parseIntSafe(els.vestMonths.value);
      const cliffMonths = parseIntSafe(els.cliffMonths.value);
      const monthsSinceStart = parseIntSafe(els.monthsSinceStart.value);
      const taxRatePercent = parseNumber(els.taxRate.value);

      const grantValid = Number.isFinite(grantTokens) && grantTokens > 0;
      const priceValid = Number.isFinite(currentPrice) && currentPrice >= 0;
      const valuationValid = Number.isFinite(expectedValuation) && expectedValuation > 0;
      const supplyValid = Number.isFinite(fdvSupply) && fdvSupply > 0;
      const vestMonthsValid = Number.isFinite(vestMonths) && vestMonths >= 1;
      const cliffValid = Number.isFinite(cliffMonths) && cliffMonths >= 0 && vestMonthsValid && cliffMonths <= vestMonths;
      const monthsSinceValid = Number.isFinite(monthsSinceStart) && monthsSinceStart >= 0;
      const taxRateValid = Number.isFinite(taxRatePercent) && taxRatePercent >= 0 && taxRatePercent <= 100;

      setFieldValidity(els.grantField, grantValid);
      setFieldValidity(els.currentPriceField, priceValid);
      setFieldValidity(els.expectedValuationField, valuationValid);
      setFieldValidity(els.fdvSupplyField, supplyValid);
      setFieldValidity(els.vestMonthsField, vestMonthsValid);
      setFieldValidity(els.cliffMonthsField, cliffValid);
      setFieldValidity(els.monthsSinceStartField, monthsSinceValid);
      setFieldValidity(els.taxRateField, taxRateValid);

      const allValid = [
        grantValid,
        priceValid,
        valuationValid,
        supplyValid,
        vestMonthsValid,
        cliffValid,
        monthsSinceValid,
        taxRateValid,
      ].every(Boolean);

      return {
        allValid,
        grantTokens,
        currentPrice,
        expectedValuation,
        fdvSupply,
        vestMonths,
        cliffMonths,
        monthsSinceStart,
        taxRate: taxRatePercent / 100,
      };
    }

    function calculate(v) {
      const impliedExitPrice = v.expectedValuation / v.fdvSupply;
      const tokensPerMonth = v.grantTokens / v.vestMonths;

      const vestedMonths = v.monthsSinceStart < v.cliffMonths
        ? 0
        : Math.min(v.monthsSinceStart, v.vestMonths);
      const vestedTokens = tokensPerMonth * vestedMonths;

      const expectedExitValue = v.grantTokens * impliedExitPrice;
      const monthlyValueToday = tokensPerMonth * v.currentPrice;

      const vestedValueToday = vestedTokens * v.currentPrice;
      const totalValueToday = v.grantTokens * v.currentPrice;

      const taxOnVestedToday = vestedValueToday * v.taxRate;
      const taxOnExitValue = expectedExitValue * v.taxRate;

      els.impliedExitPrice.textContent = formatMoney(impliedExitPrice, "USD", { maximumFractionDigits: 4 });
      els.expectedExitValue.textContent = formatMoney(expectedExitValue, "USD");

      els.monthlyTokens.textContent = `${formatNumber(tokensPerMonth, { maximumFractionDigits: 4 })} / mo`;
      els.monthlyValueToday.textContent = formatMoney(monthlyValueToday, "USD");

      els.vestedValueToday.textContent = formatMoney(vestedValueToday, "USD");
      els.totalValueToday.textContent = formatMoney(totalValueToday, "USD");

      els.taxOnVestedToday.textContent = formatMoney(taxOnVestedToday, "USD");
      els.taxOnExitValue.textContent = formatMoney(taxOnExitValue, "USD");
    }

    els.calculate.addEventListener("click", () => {
      const v = validate();
      if (!v.allValid) return;
      calculate(v);
      showResults();
    });

    document.addEventListener("keydown", (e) => {
      if (e.key !== "Enter") return;
      const t = e.target;
      if (!t || t.tagName !== "INPUT") return;
      e.preventDefault();
      const v = validate();
      if (!v.allValid) return;
      calculate(v);
      showResults();
    });

    els.results.addEventListener("transitionend", (e) => {
      if (e.propertyName !== "max-height") return;
      if (els.results.classList.contains("is-visible")) {
        els.results.style.maxHeight = "none";
      }
    });
  </script>
</body>
</html>
